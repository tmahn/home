; xterm-256-color support
; Add every color xterm supports as "xtermcolor%d", and every X color from
; x-color-alist as its nearest xterm equivalent.

(eval-when-compile
  (require 'fsf-local)
  (require 'x-color-alist)
  (require 'xterm-frobs))

  (setq xterm-color-alist
'(
(0  #x0000 #x0000 #x0000)
(1  #x8b8b #x0000 #x0000)
(2  #x0000 #x8b8b #x0000)
(3  #x8b8b #x8b8b #x0000)
(4  #x0000 #x0000 #x8b8b)
(5  #x8b8b #x0000 #x8b8b)
(6  #x0000 #x8b8b #x8b8b)
(7  #xe5e5 #xe5e5 #xe5e5)
(8  #x7f7f #x7f7f #x7f7f)
(9  #xcdcd #x0000 #x0000)
(10  #x0000 #xcdcd #x0000)
(11  #xcdcd #xcdcd #x0000)
(12  #x0000 #x0000 #xcdcd)
(13  #xcdcd #x0000 #xcdcd)
(14  #x0000 #xcdcd #xcdcd)
(15  #xffff #xffff #xffff)
(16  #x0000 #x0000 #x0000)
(17  #x0000 #x0000 #x5f5f)
(18  #x0000 #x0000 #x8787)
(19  #x0000 #x0000 #xafaf)
(20  #x0000 #x0000 #xd7d7)
(21  #x0000 #x0000 #xffff)
(22  #x0000 #x5f5f #x0000)
(23  #x0000 #x5f5f #x5f5f)
(24  #x0000 #x5f5f #x8787)
(25  #x0000 #x5f5f #xafaf)
(26  #x0000 #x5f5f #xd7d7)
(27  #x0000 #x5f5f #xffff)
(28  #x0000 #x8787 #x0000)
(29  #x0000 #x8787 #x5f5f)
(30  #x0000 #x8787 #x8787)
(31  #x0000 #x8787 #xafaf)
(32  #x0000 #x8787 #xd7d7)
(33  #x0000 #x8787 #xffff)
(34  #x0000 #xafaf #x0000)
(35  #x0000 #xafaf #x5f5f)
(36  #x0000 #xafaf #x8787)
(37  #x0000 #xafaf #xafaf)
(38  #x0000 #xafaf #xd7d7)
(39  #x0000 #xafaf #xffff)
(40  #x0000 #xd7d7 #x0000)
(41  #x0000 #xd7d7 #x5f5f)
(42  #x0000 #xd7d7 #x8787)
(43  #x0000 #xd7d7 #xafaf)
(44  #x0000 #xd7d7 #xd7d7)
(45  #x0000 #xd7d7 #xffff)
(46  #x0000 #xffff #x0000)
(47  #x0000 #xffff #x5f5f)
(48  #x0000 #xffff #x8787)
(49  #x0000 #xffff #xafaf)
(50  #x0000 #xffff #xd7d7)
(51  #x0000 #xffff #xffff)
(52  #x5f5f #x0000 #x0000)
(53  #x5f5f #x0000 #x5f5f)
(54  #x5f5f #x0000 #x8787)
(55  #x5f5f #x0000 #xafaf)
(56  #x5f5f #x0000 #xd7d7)
(57  #x5f5f #x0000 #xffff)
(58  #x5f5f #x5f5f #x0000)
(59  #x5f5f #x5f5f #x5f5f)
(60  #x5f5f #x5f5f #x8787)
(61  #x5f5f #x5f5f #xafaf)
(62  #x5f5f #x5f5f #xd7d7)
(63  #x5f5f #x5f5f #xffff)
(64  #x5f5f #x8787 #x0000)
(65  #x5f5f #x8787 #x5f5f)
(66  #x5f5f #x8787 #x8787)
(67  #x5f5f #x8787 #xafaf)
(68  #x5f5f #x8787 #xd7d7)
(69  #x5f5f #x8787 #xffff)
(70  #x5f5f #xafaf #x0000)
(71  #x5f5f #xafaf #x5f5f)
(72  #x5f5f #xafaf #x8787)
(73  #x5f5f #xafaf #xafaf)
(74  #x5f5f #xafaf #xd7d7)
(75  #x5f5f #xafaf #xffff)
(76  #x5f5f #xd7d7 #x0000)
(77  #x5f5f #xd7d7 #x5f5f)
(78  #x5f5f #xd7d7 #x8787)
(79  #x5f5f #xd7d7 #xafaf)
(80  #x5f5f #xd7d7 #xd7d7)
(81  #x5f5f #xd7d7 #xffff)
(82  #x5f5f #xffff #x0000)
(83  #x5f5f #xffff #x5f5f)
(84  #x5f5f #xffff #x8787)
(85  #x5f5f #xffff #xafaf)
(86  #x5f5f #xffff #xd7d7)
(87  #x5f5f #xffff #xffff)
(88  #x8787 #x0000 #x0000)
(89  #x8787 #x0000 #x5f5f)
(90  #x8787 #x0000 #x8787)
(91  #x8787 #x0000 #xafaf)
(92  #x8787 #x0000 #xd7d7)
(93  #x8787 #x0000 #xffff)
(94  #x8787 #x5f5f #x0000)
(95  #x8787 #x5f5f #x5f5f)
(96  #x8787 #x5f5f #x8787)
(97  #x8787 #x5f5f #xafaf)
(98  #x8787 #x5f5f #xd7d7)
(99  #x8787 #x5f5f #xffff)
(100  #x8787 #x8787 #x0000)
(101  #x8787 #x8787 #x5f5f)
(102  #x8787 #x8787 #x8787)
(103  #x8787 #x8787 #xafaf)
(104  #x8787 #x8787 #xd7d7)
(105  #x8787 #x8787 #xffff)
(106  #x8787 #xafaf #x0000)
(107  #x8787 #xafaf #x5f5f)
(108  #x8787 #xafaf #x8787)
(109  #x8787 #xafaf #xafaf)
(110  #x8787 #xafaf #xd7d7)
(111  #x8787 #xafaf #xffff)
(112  #x8787 #xd7d7 #x0000)
(113  #x8787 #xd7d7 #x5f5f)
(114  #x8787 #xd7d7 #x8787)
(115  #x8787 #xd7d7 #xafaf)
(116  #x8787 #xd7d7 #xd7d7)
(117  #x8787 #xd7d7 #xffff)
(118  #x8787 #xffff #x0000)
(119  #x8787 #xffff #x5f5f)
(120  #x8787 #xffff #x8787)
(121  #x8787 #xffff #xafaf)
(122  #x8787 #xffff #xd7d7)
(123  #x8787 #xffff #xffff)
(124  #xafaf #x0000 #x0000)
(125  #xafaf #x0000 #x5f5f)
(126  #xafaf #x0000 #x8787)
(127  #xafaf #x0000 #xafaf)
(128  #xafaf #x0000 #xd7d7)
(129  #xafaf #x0000 #xffff)
(130  #xafaf #x5f5f #x0000)
(131  #xafaf #x5f5f #x5f5f)
(132  #xafaf #x5f5f #x8787)
(133  #xafaf #x5f5f #xafaf)
(134  #xafaf #x5f5f #xd7d7)
(135  #xafaf #x5f5f #xffff)
(136  #xafaf #x8787 #x0000)
(137  #xafaf #x8787 #x5f5f)
(138  #xafaf #x8787 #x8787)
(139  #xafaf #x8787 #xafaf)
(140  #xafaf #x8787 #xd7d7)
(141  #xafaf #x8787 #xffff)
(142  #xafaf #xafaf #x0000)
(143  #xafaf #xafaf #x5f5f)
(144  #xafaf #xafaf #x8787)
(145  #xafaf #xafaf #xafaf)
(146  #xafaf #xafaf #xd7d7)
(147  #xafaf #xafaf #xffff)
(148  #xafaf #xd7d7 #x0000)
(149  #xafaf #xd7d7 #x5f5f)
(150  #xafaf #xd7d7 #x8787)
(151  #xafaf #xd7d7 #xafaf)
(152  #xafaf #xd7d7 #xd7d7)
(153  #xafaf #xd7d7 #xffff)
(154  #xafaf #xffff #x0000)
(155  #xafaf #xffff #x5f5f)
(156  #xafaf #xffff #x8787)
(157  #xafaf #xffff #xafaf)
(158  #xafaf #xffff #xd7d7)
(159  #xafaf #xffff #xffff)
(160  #xd7d7 #x0000 #x0000)
(161  #xd7d7 #x0000 #x5f5f)
(162  #xd7d7 #x0000 #x8787)
(163  #xd7d7 #x0000 #xafaf)
(164  #xd7d7 #x0000 #xd7d7)
(165  #xd7d7 #x0000 #xffff)
(166  #xd7d7 #x5f5f #x0000)
(167  #xd7d7 #x5f5f #x5f5f)
(168  #xd7d7 #x5f5f #x8787)
(169  #xd7d7 #x5f5f #xafaf)
(170  #xd7d7 #x5f5f #xd7d7)
(171  #xd7d7 #x5f5f #xffff)
(172  #xd7d7 #x8787 #x0000)
(173  #xd7d7 #x8787 #x5f5f)
(174  #xd7d7 #x8787 #x8787)
(175  #xd7d7 #x8787 #xafaf)
(176  #xd7d7 #x8787 #xd7d7)
(177  #xd7d7 #x8787 #xffff)
(178  #xd7d7 #xafaf #x0000)
(179  #xd7d7 #xafaf #x5f5f)
(180  #xd7d7 #xafaf #x8787)
(181  #xd7d7 #xafaf #xafaf)
(182  #xd7d7 #xafaf #xd7d7)
(183  #xd7d7 #xafaf #xffff)
(184  #xd7d7 #xd7d7 #x0000)
(185  #xd7d7 #xd7d7 #x5f5f)
(186  #xd7d7 #xd7d7 #x8787)
(187  #xd7d7 #xd7d7 #xafaf)
(188  #xd7d7 #xd7d7 #xd7d7)
(189  #xd7d7 #xd7d7 #xffff)
(190  #xd7d7 #xffff #x0000)
(191  #xd7d7 #xffff #x5f5f)
(192  #xd7d7 #xffff #x8787)
(193  #xd7d7 #xffff #xafaf)
(194  #xd7d7 #xffff #xd7d7)
(195  #xd7d7 #xffff #xffff)
(196  #xffff #x0000 #x0000)
(197  #xffff #x0000 #x5f5f)
(198  #xffff #x0000 #x8787)
(199  #xffff #x0000 #xafaf)
(200  #xffff #x0000 #xd7d7)
(201  #xffff #x0000 #xffff)
(202  #xffff #x5f5f #x0000)
(203  #xffff #x5f5f #x5f5f)
(204  #xffff #x5f5f #x8787)
(205  #xffff #x5f5f #xafaf)
(206  #xffff #x5f5f #xd7d7)
(207  #xffff #x5f5f #xffff)
(208  #xffff #x8787 #x0000)
(209  #xffff #x8787 #x5f5f)
(210  #xffff #x8787 #x8787)
(211  #xffff #x8787 #xafaf)
(212  #xffff #x8787 #xd7d7)
(213  #xffff #x8787 #xffff)
(214  #xffff #xafaf #x0000)
(215  #xffff #xafaf #x5f5f)
(216  #xffff #xafaf #x8787)
(217  #xffff #xafaf #xafaf)
(218  #xffff #xafaf #xd7d7)
(219  #xffff #xafaf #xffff)
(220  #xffff #xd7d7 #x0000)
(221  #xffff #xd7d7 #x5f5f)
(222  #xffff #xd7d7 #x8787)
(223  #xffff #xd7d7 #xafaf)
(224  #xffff #xd7d7 #xd7d7)
(225  #xffff #xd7d7 #xffff)
(226  #xffff #xffff #x0000)
(227  #xffff #xffff #x5f5f)
(228  #xffff #xffff #x8787)
(229  #xffff #xffff #xafaf)
(230  #xffff #xffff #xd7d7)
(231  #xffff #xffff #xffff)
(232  #x0808 #x0808 #x0808)
(233  #x1212 #x1212 #x1212)
(234  #x1c1c #x1c1c #x1c1c)
(235  #x2626 #x2626 #x2626)
(236  #x3030 #x3030 #x3030)
(237  #x3a3a #x3a3a #x3a3a)
(238  #x4444 #x4444 #x4444)
(239  #x4e4e #x4e4e #x4e4e)
(240  #x5858 #x5858 #x5858)
(241  #x6262 #x6262 #x6262)
(242  #x6c6c #x6c6c #x6c6c)
(243  #x7676 #x7676 #x7676)
(244  #x8080 #x8080 #x8080)
(245  #x8a8a #x8a8a #x8a8a)
(246  #x9494 #x9494 #x9494)
(247  #x9e9e #x9e9e #x9e9e)
(248  #xa8a8 #xa8a8 #xa8a8)
(249  #xb2b2 #xb2b2 #xb2b2)
(250  #xbcbc #xbcbc #xbcbc)
(251  #xc6c6 #xc6c6 #xc6c6)
(252  #xd0d0 #xd0d0 #xd0d0)
(253  #xdada #xdada #xdada)
(254  #xe4e4 #xe4e4 #xe4e4)
(255  #xeeee #xeeee #xeeee)
)
)

(eval-when-compile
  (setq color-name-rgb-alist xterm-color-alist)
  (setq xterm-color-name-alist
	(mapcar (lambda (x-color)
		  (let* ((color-name (car x-color))
			 (color (cdr x-color))
			 (n (car (xterm-color-approximate color))))
		    (list n color-name)))
		x-color-alist))
  )
(setq xterm-color-name-alist (eval-when-compile xterm-color-name-alist))

(defun register-xterm-color (number name)
  (register-tty-color name
		      (format "\e[38;5;%dm" number)
		      (format "\e[48;5;%dm" number)))

(mapcar (lambda (color-and-name)
	  (let ((color (car color-and-name))
		(name (cadr color-and-name)))
	    (register-xterm-color color name)))
	xterm-color-name-alist)

; And make everything accessible as "xtermcolor%d" as well
(let ((n 0))
  (while (< n 256)
    (register-xterm-color
     n
     (format "xtermcolor%d" n))
    (setq n (1+ n))))

(provide 'xterm-256-color)
