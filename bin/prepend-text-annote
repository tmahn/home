#!/bin/bash

# Insert the contents of the clipboard as plain text on an new page at the
# front of the indicated PDF

set -eu
set -o pipefail

PROG="$(basename -- "${0}")"

TMP_PDF_IN="$(mktemp -t "${PROG}.pdf")"
TMP_PDF_OUT="$(mktemp -t "${PROG}.pdf")"
trap 'rm -f "${TMP_PDF_IN}" "${TMP_PDF_OUT}"' 0 1 2 3 15

if (( $# != 1 )); then
    echo RTFSRC
fi

PDF="${1}"

pbpaste | paps --paper=letter \
    | gs -q -dSAFER -dNOPAUSE -sDEVICE=pdfwrite -sOutputFile="${TMP_PDF_IN}" \
        >/dev/null

pdftk A="${TMP_PDF_IN}" B="${PDF}" cat A B output "${TMP_PDF_OUT}"
cat "${TMP_PDF_OUT}" > "${PDF}"
